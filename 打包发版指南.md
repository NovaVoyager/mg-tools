# 打包发版指南

> 版本: 1.0.0 | 更新日期: 2025年1月

---

## 一、环境准备

### 1.1 必要软件

- Node.js >= 18.0.0
- npm >= 9.0.0 或 yarn >= 1.22.0 或 pnpm >= 8.0.0
- Git（用于版本管理）

### 1.2 检查环境

在终端中运行以下命令确认环境版本：

```bash
node -v
npm -v
```

---

## 二、项目初始化

### 2.1 创建 React 项目

推荐使用 Vite 创建项目（构建速度更快）：

```bash
# 使用 Vite 创建项目
npm create vite@latest image-converter -- --template react

# 进入项目目录
cd image-converter

# 安装依赖
npm install
```

### 2.2 添加组件文件

将 `ImageConverter.jsx` 文件复制到 `src` 目录下，并修改 `App.jsx`：

```jsx
// src/App.jsx
import ImageConverter from './ImageConverter'

function App() {
  return <ImageConverter />
}

export default App
```

---

## 三、本地开发与测试

### 3.1 启动开发服务器

```bash
npm run dev
```

访问 http://localhost:5173 查看效果。

### 3.2 测试检查项

1. 上传图片功能是否正常
2. 拖拽上传是否可用
3. 格式转换是否正确（PNG/JPEG/WebP）
4. 质量调节滑块是否生效
5. 转换后图片预览是否正常显示
6. 下载文件名格式是否为 `mg-{时间戳}.{扩展名}`
7. 重置功能是否正常

---

## 四、生产构建

### 4.1 执行构建命令

```bash
npm run build
```

构建产物将输出到 `dist` 目录。

### 4.2 本地预览构建结果

```bash
npm run preview
```

---

## 五、部署方式

### 5.1 静态服务器部署

将 `dist` 目录内容上传到任意静态服务器（Nginx、Apache 等）：

```nginx
# Nginx 配置示例
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/image-converter/dist;
    index index.html;
}
```

### 5.2 云平台一键部署

**Vercel（推荐）**

```bash
npm install -g vercel
vercel
```

**Netlify**

```bash
npm install -g netlify-cli
netlify deploy --prod --dir=dist
```

### 5.3 GitHub Pages 部署

1. 修改 `vite.config.js`，添加 base 配置：

```js
export default defineConfig({
  base: '/your-repo-name/',
  plugins: [react()]
})
```

2. 安装 gh-pages 并配置部署脚本：

```bash
npm install -D gh-pages
```

在 `package.json` 中添加脚本：

```json
{
  "scripts": {
    "deploy": "npm run build && gh-pages -d dist"
  }
}
```

3. 执行部署：

```bash
npm run deploy
```

---

## 六、常见问题

| 问题 | 解决方案 |
|------|----------|
| 构建失败 | 检查 Node.js 版本，清除 node_modules 后重新安装 |
| 部署后页面空白 | 检查 vite.config.js 中的 base 路径配置 |
| 图片转换失败 | 确认浏览器支持 Canvas API，检查图片格式是否合法 |
| WebP 不支持 | 升级浏览器版本，或提示用户使用现代浏览器 |

---

## 七、项目结构

```
image-converter/
├── dist/                 # 构建输出目录
├── node_modules/         # 依赖包
├── src/
│   ├── App.jsx           # 根组件
│   ├── ImageConverter.jsx # 核心组件
│   └── main.jsx          # 入口文件
├── index.html
├── package.json
└── vite.config.js        # Vite 配置
```

---

## 附录：快速命令参考

| 命令 | 说明 |
|------|------|
| `npm run dev` | 启动开发服务器 |
| `npm run build` | 生产环境构建 |
| `npm run preview` | 预览构建结果 |
| `npm run deploy` | 部署到 GitHub Pages |
